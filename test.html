<html>
    <head>
        <title>Test</title>
    </head>

    
    <style>
        
        div { position: relative; float: left; height: 24; width: 12; outline: 1px dotted orange; outline-offset: -1px }
        pre { margin: 2px}
        
        .firstcol { clear: both;}

        .text{ width: auto;}
        
        .node {
            position: absolute;
             top: 25%;
             left: 0%;
             height: 50%;
             width: 100%;
             z-index: 10;
        }        
         
        .bridge {
            position: absolute;
             top: 25%;
             left: -50%;
             height: 50%;
             width: 200%;
             z-index: 1;
        }  
               
        .slash { 
             position: absolute; 
             top: 50%;
             left: -50%;
             height: 100%;
             width: 100%;
             z-index: 1;
        }    
               
        .wideslash { 
             position: absolute; 
             top: 50%;
             left: -50%;
             height: 100%;
             width: 200%;
             z-index: 1;
        }  
                
        .backslash { 
             position: absolute; 
             top: 50%;
             left: 50%;
             height: 100%;
             width: 100%;
             z-index: 1;
        }  
            
        .widebackslash { 
             position: absolute; 
             top: 50%;
             left: -50%;
             height: 100%;
             width: 200%;
             z-index: 1;
        }

        .pipe {
             position: absolute;
             top: 50%;
             left: 0%;
             height: 110%;
             width: 100%;
             z-index: 1;
        } 

   
    </style>
  
    
<body>


    
<script>
var graphText = '';

// Example : git log --graph --date-order --oneline   
graphText = String.raw`* 7ac659d (HEAD -> develop, origin/develop) Add script SPM viewer
* 7fe5f6f Fix accidental commit
*   d267661 Merge remote-tracking branch 'origin/develop' into develop
|\  
* | cf12312 Revert "Fix that search-field was not always fully shown"
| * bdfd286 Fix that search-field was not always fully shown
|/  
* 6f99d86 Improve again
* 6e60ebc Improve update script -- to solve installing deeper and deeper
* d9338fe Make update recognize github zip structure
* 8bcc562 USER_SCRIPT folder updated
* f300d65 Set version.txt
*   3924c62 Update from github
|\  
| * abeb22e (origin/feature/update, feature/update) Fix USER_SCRIPT path
| * 9848d08 Move update to github -- first commit
|/  
* aea50f1 Start testing Github site
*   33b9dc3 Fix opening 1.2.840.10008.1.2
|\  
| * f7097f6 Fix error opening 1.2.840.10008.1.2
| * 50f3260 test3
| *   f08591a Merge branch 'master' of https://github.com/JanAxelsson/imlook4d
| |\  
| | * 572046d Set theme jekyll-theme-architect
| * | 7b1e3cd test page 2
| * | 1af4e37 test page
| | * 44ad9df Set theme jekyll-theme-midnight
| |/  
| *   4970dcd (tag: 5.2.0) 5.2.0
| |\  
| |/  
|/|   
* | 6055e61 test`



graphText2 = String.raw`
 * *   *  *  * *  *    * *  * *    
 * |  /   |  |  \  \   | |  | |   
 * | /   /    \  \  \  |/    \|    
 * | \  /      \    / /|      |\    
 * |  \            /  \|      |/     
 *     *          *    |\    /|     `


graphText2 = String.raw`
  * * *   
   \|/   
    |    
   /|\    
  * * *  
             
  * *      * *
   \|      |/   
    |\    /|    
    * *  * *   
                                 
   *   *   *  *
   *   |  /    \
                       
   /   /   /   /   
  *   |   /    \   
  *   *  *      *   
                                                  
   *   *   *  *  
   |   |   |  |   
   *   |  /    \  
   *   * *      *  
                         
`
// Examples defining algorithm
graphText = String.raw`
 * *      * *  A * *      * *  
  \|      |/   A  \|      |/           
   |\    /|    A   |\    /|    
   * *  * *    A   * *  * *             
                         
 \  \  \      /  /   / B \  \  \      /  /   /          
  |  *  \    |  *   /  B  |  *  \    |  *   /          
                          
 *  *  *    C   *  *  *    
/   |   \   C  /   |   \          
               
 * *       D  * *       
 |_|       D  |_|       this line is the important test
/   \      D /   \      
 
 *   *     E  *   *     
  \ /      E   \ /      
  / \      E   / \      
 *   *     E  *   *     
             NOTE: requires space not to fail
  * * *    F   * * *    
 /  |  \   F  /  |  \   
    |   *  F     |   *       
             NOTE: requires space not to fail
 
`   

const BUFFERTCOLS = '  '; // Allows to look to the left of current character
const BUFFERTROW = '                                                        ';
graphText +=  "\n" + BUFFERTROW + "\n" + BUFFERTROW; 

console.log(graphText)

var splitted = graphText.split("\n");
console.log(splitted)

for(var row = 0; row < (splitted.length - 1); row++) {
    let sumFound ='';
    
    document.body.innerHTML += '<div class="firstcol"></div> ' // New row
    for(var i = 0 ; i < splitted[row].length ; i++){
        let total = '';
        let found = '';

        
        // Draw node
        if (  a(0,'*') ){
            total += '<img class="node" src="images/circle_red.png">'; // Draw node
        }
 
        //
        // Draw lines
        //
        
        // Select what to draw -- first hit wins :
        
        // -------------
        if (  a(0,'|') && a(-1, '\\') && b(0,'|') && b(1,'\\')  ) {
            // A) Crossing down-right 
            found = 'A1';
            total += '<img class="pipe" src="images/pipe.png">';
            total += '<img class="widebackslash" src="images/widebackslash.png">';  
        }else if (  a(0,'|') && a(1, '/') && b(-1,'/') && b(0,'|')  ) {
            
            // A) Crossing down-left 
            found = 'A2';
            total += '<img class="pipe" src="images/pipe.png">';
            total += '<img class="wideslash"  src="images/wideslash.png">';  
               
        // -------------
        }else if (  a(0,'\\') && !b(1,' ') && b(2,' ')  ) {   
        // B) back-slash 
            found = 'B1';
            total += '<img class="backslash" src="images/backslash.png">';
            
        }else if (  a(0,'/') && !b(-1,' ') && b(-2,' ')  ) {
            // B) slash 
            found = 'B2';
            total += '<img class="slash" src="images/slash.png">';
         
        // -------------   
        }else if (  a(0,'|')  ) {
            
            if (  a(0,'|') && !b( -1,'\\') && !b( -1,' ')  ) {
            // C) slash 
                found += ' C1';
                total += '<img class="slash" src="images/slash.png">';
                
            }
            if (  a(0,'|') && !b( 0,' ') ) {
            // C) pipe 
                found += ' C2';
                total += '<img class="pipe" src="images/pipe.png">';
                
            }
            if (  a(0,'|') && !b( 1,'/') && !b( 1,' ')  ) {
            // C) back-slash 
                found += ' C3';
                total += '<img class="backslash" src="images/backslash.png">';
            }
        // -------------    
        }else if (  a(0,'_') ) {
        // D) bridge
            found = 'D';
            total += '<img class="bridge" src="images/bridge.png">';
            
        // -------------
        }else if (  a(0,'\\') && b(0,'/')  ) {
        // E) pipe 
            found = 'E1';
            total += '<img class="pipe" src="images/pipe.png">';
            
        }else if (  a(0,'/') && b( 0,'\\')  ) {
        // E) pipe 
            found = 'E2';
            total += '<img class="pipe" src="images/pipe.png">';
            
        // -------------
        }else if (  a(0,'*') ){ 
        // F) draw one or more lines from node
        
            if (  a(0,'*') && b( -1,'/') && ( b( 0,'|')||b( 0,' ')||b( 0,'*') ) ) {
            // F) slash 
                found += ' F1';
                total += '<img class="slash" src="images/slash.png">'; 
            }
            if (  a(0,'*') && !b( 0,' ') && ( b( 0,'|')||b( 0,' ')||b( 0,'*') )  ) {
            // F) pipe 
                found += ' F2';
                total += '<img class="pipe" src="images/pipe.png">';
            }
            if (  a(0,'*') && b( 1,'\\') && ( b( 0,'|')||b( 0,' ')||b( 0,'*')||b( 0,'_') ) ) {
            // F) back-slash 
                found += ' F3';
                total += '<img class="backslash" src="images/backslash.png">';
            }
        // -------------

        }else if (  !a(0,'*') && !a(0,'\\')  && !a(0,'|') && !a(0,'/') && !a(0,'_') && !a(0,' ') ){
        // TEXT if nothing else
            document.body.innerHTML += '<div class="text"><pre>' + splitted[row].substring(i) + '   ' + sumFound + '</pre></div>'
            i = splitted[row].length;
            continue // skip rest of row
        }

        // Make div with content from above
        document.body.innerHTML += '<div>' + total +'</div>';
        
        if (found !== ''){
            sumFound += ' ' + found;
        }
    }
    console.log('ROW = ' + row + '  ' + sumFound);
    
    function a(index, c){
        let currentRow = BUFFERTCOLS + splitted[ row ];
        index = index + BUFFERTCOLS.length;
        let answer = currentRow[i+index] === c;
        //console.log(answer + '  ' + c + ' (a) Row = ' + row + '  col = ' + i + '  index = ' + index );
        return answer;
    }
    
    function b(index, c){
        let nextRow = BUFFERTCOLS + splitted[ row + 1];
        index = index + BUFFERTCOLS.length;
        let answer = nextRow[i+index] === c;
        //console.log(answer + '  ' + c + ' (b) Row = ' + row + '  col = ' + i + '  index = ' + index );
        return answer;
    }    
    
}
        
        
</script>  

</body>
</html>
